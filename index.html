<html>
  <head>
    <title>Ferien!!!</title>
    <link rel="stylesheet" href="https://bootswatch.com/4/superhero/bootstrap.css">
  </head>
  <body>
    <!-- <{tag} {attribut}>{content}</{tag}> -->
    <h1>Ferien-Countdown</h1>
    <p id="Ferien-CD">moin meista!</p>
    <h3 id="ferienArt" >bis zu den Osterferien!</h3>

    <select id="ferienAuswahl">
      <option value ="winterferien-2022-TH"> Winterferienâ›„</option>
      <option value ="osterferien-2022-TH"> Osterferien</option>
      <option value ="pfingstferien-2022-TH"> Pfingstferien</option>
      <option value ="sommerferien-2022-TH"> SommerferienðŸ¤½</option>
      <option value ="herbstferien-2022-TH"> Herbstferien</option>
      <option value ="weihnachtsferien-2022-TH"> WeihnachtsferienðŸŽ„</option>
    </select>

    <br><br>
    <table border="4px" id="datenTabelle">
      <thead>
        <tr>
          <td>
            <p>Ferien</p>
          </td>
          <td>
            <p>Beginn</p>
          </td>
          <td>
            <p>Ende</p>
          </td>
        </tr>
      </thead>
    </table>
    <br><br>
    <a href="https://github.com/lgh-ag/lghag.de">die tooolen Coder<a>

    <script src="https://cdn.jsdelivr.net/npm/underscore@latest/underscore-umd-min.js"></script>

    <script>

      var json = "";
      var obj = null;
      var ferienDate = null;

      function reqListener () {
        json = this.responseText;
        obj = JSON.parse(json);
        
        selectChange();
        getSeconds();
        tabbelledatenholen();
      }

      var oReq = new XMLHttpRequest();
      oReq.addEventListener("load", reqListener);
      oReq.open("GET", "https://lgh-ag-cors.herokuapp.com/https://ferien-api.de/api/v1/holidays/TH/2022");
      oReq.setRequestHeader("x-requested-with", "lghag.de")
      oReq.send();
      
      function getSeconds() {
    
        var CurrentDate = Date.now();

        var  milli = ferienDate - CurrentDate 
       
        var abgezogen = 0;
        
        var Wochen = Math.floor((milli - abgezogen) /1000 / 60 / 60 /24 / 7);
        abgezogen = abgezogen + Wochen *1000 * 60 * 60 * 24 * 7;

        var Tage = Math.floor((milli - abgezogen) /1000 / 60 / 60 /24);
        abgezogen = abgezogen + Tage *1000 * 60 * 60 * 24;

        var stunden = Math.floor((milli - abgezogen) /1000 / 60 / 60);
        abgezogen = abgezogen + stunden *1000 * 60 * 60;       
        
        var minuten = Math.floor((milli - abgezogen) /1000 / 60);
        abgezogen = abgezogen + minuten *1000 * 60;
        
        var sekunden = Math.floor((milli - abgezogen) /1000);
        abgezogen = abgezogen + sekunden *1000;
        
        document.getElementById("Ferien-CD").innerText = "Das sind : "  + Wochen + " Wochen, " + Tage + " Tage, " + stunden + " Stunden, " + minuten + " Minuten und " + sekunden + " Sekunden"
        setTimeout(getSeconds, 1000); 
      }

      var select = document.getElementById("ferienAuswahl")
      
      function selectChange() {
        ferienDate = Date.parse(_.where(obj, {"slug": select.value})[0].start);
        var ferien = _.where(obj, {"slug" : select.value})[0].name;
        document.getElementById("ferienArt").innerHTML = "bis zu den " + ferien.slice(0, 1).toUpperCase () + ferien.slice(1) + "! ðŸ“…";
        getSeconds();
      }

      function tabbelledatenholen () {
        var i;
        for (i = 0; i < obj.length; i++) {
          tabelleausfÃ¼llen(i+1, obj[i].name, obj[i].start, obj[i].end );
        }
        
        
      }

      function tabelleausfÃ¼llen(targetRow, cell1text, cell2text, cell3text) {
        var table = document.getElementById("datenTabelle");
        var row = table.insertRow(targetRow);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        cell1.innerHTML = cell1text;
        cell2.innerHTML = cell2text;
        cell3.innerHTML = cell3text;
      }

     
      select.onchange = selectChange; 
    </script>
  </body>
</html>

